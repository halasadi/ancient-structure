---
title: 'Exploratory analysis of ancient data'
author: "Kushal K Dey, Hussein Al asadi"
date: "August 7, 2015"
output: html_document
---

## Admixture

```{r admix, echo=FALSE, eval=TRUE}
library(data.table)
data.clst <- read.csv('data.clst', stringsAsFactors = FALSE, header=FALSE, sep = "\t");
data.fam <- read.table('haak_fig3_set.fam');

pop_ids <- data.clst[match(data.fam$V2, data.clst$V2),3]


plot_admixture <- function(K, pop_ids)
{
  P_data <- data.frame(fread(paste0('Admixture/haak_fig3_set.',K,'.P')));
  Q_data <- data.frame(fread(paste0('Admixture/haak_fig3_set.',K,'.Q')));


  barplot(t(Q_data),col=2:(K+1),axisnames=F,space=0,border=NA,main=paste("No. of clusters=",K),las=1,ylim=c(0,1),cex.axis=0.5,cex.main=1.4);
  
  labels = match(unique(pop_ids), pop_ids);
  abline(v=labels-1)

  labels_low=labels-1;
  labels_up=c(labels_low[2:length(labels_low)],dim(Q_data)[1]);
  mid_point <- labels_low +0.5*(labels_up-labels_low);
  axis(1,at=mid_point, unique(pop_ids),las=2,cex.axis=0.5);

}

plot_admixture(3,pop_ids)
plot_admixture(5,pop_ids)
plot_admixture(7,pop_ids)

```

## PCA

```{r pca, echo=FALSE, eval=TRUE}

pca_eigenvalues <- data.frame(read.table('PCA/pca_eigenvalues.txt'));
pca_eigenvectors <- data.frame(fread('PCA/pca_eigenvectors.txt'), row.names=TRUE);

plot_pc <- function(lab1,lab2)
{
  eigen1 = as.numeric(pca_eigenvectors[,lab1])
  eigen2 = as.numeric(pca_eigenvectors[,lab2])
  plot(0, xlim = c(min(eigen1), max(eigen1)), ylim = c(min(eigen2), max(eigen2)),xlab=paste0("PC   ",lab1),ylab=paste0("PC ",lab2));
  text(eigen1, eigen2 ,pop_ids,cex=0.5)
}

plot_pc(1,2)
plot_pc(1,3)
plot_pc(2,3)


```

## Treemix

```{r treemix, echo=TRUE, eval=FALSE}
source("Treemix/plotting_funcs.R")
plot_tree("Treemix/out_stem")
```

